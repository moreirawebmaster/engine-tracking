# Engine Tracking

<div align="center">
  <img src="assets/images/logo.png" alt="Engine Tracking Logo" width="300" />
</div>

## üìã Sobre o Projeto

[![pub.dev](https://img.shields.io/pub/v/engine_tracking.svg)](https://pub.dev/packages/engine_tracking)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Flutter](https://img.shields.io/badge/Flutter-3.32.0+-blue.svg)](https://flutter.dev/)
[![Dart](https://img.shields.io/badge/Dart-3.8.0+-blue.svg)](https://dart.dev/)

Uma biblioteca Flutter completa para **tracking de analytics** e **bug reporting**, oferecendo integra√ß√£o com Firebase Analytics, Firebase Crashlytics, Microsoft Clarity, Grafana Faro, Splunk e Google Cloud Logging.

### üì± Plataformas Suportadas
- ‚úÖ iOS
- ‚úÖ Android

---

## üöÄ Principais Caracter√≠sticas

- üìä **Analytics M√∫ltiplo**: Firebase Analytics, Microsoft Clarity, Grafana Faro, Splunk e Google Cloud Logging
- üêõ **Bug Tracking Avan√ßado**: Firebase Crashlytics, Grafana Faro e Google Cloud Logging para monitoramento completo
- üåê **HTTP Tracking**: Monitoramento autom√°tico de requisi√ß√µes HTTPS com m√©tricas detalhadas
- üëÅÔ∏è **View Tracking**: Sistema autom√°tico de tracking de telas com `EngineStatelessWidget` e `EngineStatefulWidget`
- ‚öôÔ∏è **Configura√ß√£o Flex√≠vel**: Ative/desative servi√ßos individualmente atrav√©s de configura√ß√µes
- üìù **Logging Estruturado**: Sistema de logs com diferentes n√≠veis e contextos
- üÜî **Session ID Autom√°tico**: UUID v4 √∫nico por abertura do app para correla√ß√£o de logs e analytics
- üîí **Tipo-seguro**: Implementa√ß√£o completamente tipada em Dart
- üõ°Ô∏è **Confi√°vel**: Implementa√ß√£o robusta e est√°vel para aplica√ß√µes empresariais
- üèóÔ∏è **Arquitetura Consistente**: Padr√£o unificado entre Analytics e Bug Tracking
- üéØ **Inicializa√ß√£o Condicional**: Servi√ßos s√£o inicializados apenas se habilitados na configura√ß√£o
- üì¶ **Export Unificado**: Todos os imports atrav√©s de `package:engine_tracking/engine_tracking.dart`
- üöÄ **Exemplos Completos**: Apps de demonstra√ß√£o com casos de uso reais (HTTP + View Tracking)

---

## üó∫Ô∏è Arquitetura da Solu√ß√£o

### üÜî Sistema de Session ID (Correla√ß√£o Autom√°tica)

```mermaid
graph TD
    A["App Initialization"] --> B["EngineSession.instance"]
    B --> C["Generate UUID v4"]
    C --> D["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"]
    
    D --> E["Session ID em Mem√≥ria"]
    E --> F["Auto-inject Autom√°tico"]
    
    G["EngineAnalytics.logEvent()"] --> F
    H["EngineBugTracking.log()"] --> F
    I["EngineLog.info()"] --> F
    J["Firebase Analytics"] --> F
    K["Google Cloud Logging"] --> F
    L["Crashlytics"] --> F
    
    F --> M["Enrich Data"]
    M --> N["session_id: UUID v4"]
    
    N --> O["Firebase Analytics"]
    N --> P["Google Cloud Logging"] 
    N --> Q["Grafana Faro"]
    N --> R["Splunk"]
    N --> S["Crashlytics"]
    
    U["Correla√ß√£o de Logs"] --> V["Mesmo session_id"]
    V --> W["Jornada Completa do Usu√°rio"]
```

### üì± Widgets Stateless e Stateful com Tracking Autom√°tico

```mermaid
graph TD
    A["App"] --> B["EngineStatelessWidget"]
    A --> C["EngineStatefulWidget"]
    
    B --> D["buildWithTracking()"]
    C --> E["buildWithTracking()"]
    
    B --> F["M√©todos Execut√°veis"]
    C --> G["M√©todos Execut√°veis"]
    
    F --> H["logUserAction()"]
    F --> I["logCustomEvent()"]
    F --> J["logScreenError()"]
    
    G --> K["logUserAction()"]
    G --> L["logCustomEvent()"]
    G --> M["logScreenError()"]
    G --> N["logStateChange()"]
    
    H --> O["EngineLog.debug()"]
    I --> O
    J --> P["EngineLog.error()"]
    K --> O
    L --> O
    M --> P
    N --> O
    
    B --> Q["Lifecycle Tracking"]
    C --> R["Lifecycle Tracking"]
    
    Q --> S["screen_initialized"]
    Q --> T["screen_viewed"]
    Q --> U["screen_closed"]
    
    R --> V["screen_initialized"]
    R --> W["screen_viewed"]
    R --> X["screen_closed"]
    
    S --> O
    T --> O
    U --> O
    V --> O
    W --> O
    X --> O
```

### üìù Sistema de Logging (EngineLog)

```mermaid
graph TD
    A["Aplica√ß√£o"] --> B["EngineLog"]
    
    B --> C["debug()"]
    B --> D["info()"]
    B --> E["warning()"]
    B --> F["error()"]
    B --> G["fatal()"]
    
    C --> H["_logWithLevel()"]
    D --> H
    E --> H
    F --> H
    G --> H
    
    H --> I["developer.log()"]
    H --> J{{"EngineAnalytics.isEnabled && includeInAnalytics?"}}
    H --> K{{"EngineBugTracking.isEnabled?"}}
    
    J -->|Sim| L["EngineAnalytics.logEvent()"]
    J -->|N√£o| M["Skip Analytics"]
    
    K -->|Sim| N["EngineBugTracking.log()"]
    K -->|N√£o| O["Skip Bug Tracking"]
    
    L --> P["Firebase Analytics"]
    L --> Q["Grafana Faro"]
    L --> R["Splunk"]
    
    N --> T["Firebase Crashlytics"]
    N --> U["Grafana Faro Bug Tracking"]
    
    K -->|Sim| V{{"level == error || fatal?"}}
    V -->|Sim| W["EngineBugTracking.recordError()"]
    V -->|N√£o| X["Apenas log normal"]
    
    W --> Y["Crash Reporting"]
    Y --> T
    Y --> U
```

### üìä Sistema de Analytics (EngineAnalytics)

```mermaid
graph TD
    A["Aplica√ß√£o"] --> B["EngineAnalytics"]
    
    B --> C["init()"]
    B --> D["logEvent()"]
    B --> E["setUserId()"]
    B --> F["setUserProperty()"]
    B --> G["setPage()"]
    B --> H["logAppOpen()"]
    
    C --> I["EngineAnalyticsModel"]
    I --> J["Firebase Analytics Config"]
    I --> K["Faro Config"]
    I --> L["Splunk Config"]
    I --> M["Google Logging Config"]
    
    D --> O["Adapters"]
    E --> O
    F --> O
    G --> O
    H --> O
    
    O --> P["EngineFirebaseAnalyticsAdapter"]
    O --> Q["EngineFaroAnalyticsAdapter"]
    O --> R["EngineSplunkAnalyticsAdapter"]
    O --> S["EngineGoogleLoggingAnalyticsAdapter"]
    
    P --> T["Firebase Analytics SDK"]
    Q --> U["Grafana Faro SDK"]
    R --> V["Splunk SDK"]
    S --> W["Google Cloud Logging API"]
    
    T --> X["Google Analytics Dashboard"]
    U --> Y["Grafana Dashboard"]
    V --> Z["Splunk Dashboard"]
    W --> AA["Google Cloud Console"]
```

### üêõ Sistema de Bug Tracking (EngineBugTracking)

```mermaid
graph TD
    A["Aplica√ß√£o"] --> B["EngineBugTracking"]
    
    B --> C["init()"]
    B --> D["log()"]
    B --> E["recordError()"]
    B --> F["recordFlutterError()"]
    B --> G["setCustomKey()"]
    B --> H["setUserIdentifier()"]
    B --> I["testCrash()"]
    
    C --> J["EngineBugTrackingModel"]
    J --> K["Crashlytics Config"]
    J --> L["Faro Config"]
    J --> M["Google Logging Config"]
    
    D --> N["Adapters"]
    E --> N
    F --> N
    G --> N
    H --> N
    I --> N
    
    N --> O["EngineCrashlyticsAdapter"]
    N --> P["EngineFaroBugTrackingAdapter"]
    N --> Q["EngineGoogleLoggingBugTrackingAdapter"]
    
    O --> R["Firebase Crashlytics SDK"]
    P --> S["Grafana Faro SDK"]
    Q --> T["Google Cloud Logging API"]
    
    R --> U["Firebase Console"]
    S --> V["Grafana Dashboard"]
    T --> W["Google Cloud Console"]
    
    X["Flutter Error Handler"] --> F
    Y["Platform Error Handler"] --> E
    
    Z["Custom Errors"] --> E
    AA["Logging Events"] --> D
```

---

## üì¶ Instala√ß√£o

Adicione ao seu `pubspec.yaml`:

```yaml
dependencies:
  engine_tracking: ^1.4.0
```

Execute:

```bash
flutter pub get
```

---

## üöÄ Exemplos de Uso

### üì± Exemplos Inclusos

O pacote inclui exemplos completos demonstrando todas as funcionalidades:

```bash
cd example && flutter run
```

- **üì± Exemplo Principal**: Inicializa√ß√£o, tracking de eventos, propriedades de usu√°rio e navega√ß√£o
- **üåê Exemplo HTTP Tracking**: Requisi√ß√µes com Pok√©API e JSONPlaceholder
- **üëÅÔ∏è Exemplo View Tracking**: Sistema autom√°tico de tracking de telas

### üöÄ Inicializa√ß√£o Centralizada (Recomendado)

**Novo!** Use o `EngineTrackingInitialize` para inicializar Analytics e Bug Tracking de uma s√≥ vez:

```dart
import 'package:engine_tracking/engine_tracking.dart';

// Ambos os servi√ßos
await EngineTrackingInitialize.initWithModels(
  analyticsModel: EngineAnalyticsModel(/* configs */),
  bugTrackingModel: EngineBugTrackingModel(/* configs */),
);

// Apenas Analytics
await EngineTrackingInitialize.initWithModels(
  analyticsModel: EngineAnalyticsModel(/* configs */),
  bugTrackingModel: null,
);

// Apenas Bug Tracking
await EngineTrackingInitialize.initWithModels(
  analyticsModel: null,
  bugTrackingModel: EngineBugTrackingModel(/* configs */),
);

// Com Adapters (controle granular)
await EngineTrackingInitialize.initWithAdapters(
  analyticsAdapters: [EngineFirebaseAnalyticsAdapter(/* config */)],
  bugTrackingAdapters: null, // Skip bug tracking
);

// Inicializa√ß√£o r√°pida (ambos desabilitados)
await EngineTrackingInitialize.initWithDefaults();

// Status
bool bothReady = EngineTrackingInitialize.isInitialized;
bool anyEnabled = EngineTrackingInitialize.isEnabled;

// Cleanup
await EngineTrackingInitialize.dispose();
```

### üéØ Configura√ß√£o B√°sica (M√©todo Individual)

```dart
import 'package:engine_tracking/engine_tracking.dart';

Future<void> setupTracking() async {
  final analyticsModel = EngineAnalyticsModel(
    firebaseAnalyticsConfig: const EngineFirebaseAnalyticsConfig(enabled: true),
    clarityConfig: const EngineClarityConfig(
      enabled: true,
      projectId: 'seu-projeto-clarity',
    ),
    faroConfig: const EngineFaroConfig(
      enabled: true,
      endpoint: 'https://faro-collector.grafana.net/collect',
      appName: 'MeuApp',
      appVersion: '1.0.0',
      environment: 'production',
      apiKey: 'sua-chave-api-faro',
    ),
    googleLoggingConfig: const EngineGoogleLoggingConfig(
      enabled: true,
      projectId: 'seu-projeto-gcp',
      logName: 'engine-tracking',
      credentials: {
        "type": "service_account",
        "project_id": "seu-projeto-gcp",
        "private_key_id": "...",
        "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
        "client_email": "sua-service-account@seu-projeto-gcp.iam.gserviceaccount.com",
        // ... resto das credenciais
      },
      resource: {
        'type': 'global',
        'labels': {'project_id': 'seu-projeto-gcp'},
      },
    ),
    splunkConfig: const EngineSplunkConfig(enabled: false),
  );

  final bugTrackingModel = EngineBugTrackingModel(
    crashlyticsConfig: const EngineCrashlyticsConfig(enabled: true),
    faroConfig: const EngineFaroConfig(
      enabled: true,
      endpoint: 'https://faro-collector.grafana.net/collect',
      appName: 'MeuApp',
      appVersion: '1.0.0',
      environment: 'production',
      apiKey: 'sua-chave-api-faro',
    ),
    googleLoggingConfig: const EngineGoogleLoggingConfig(enabled: true, /* configs */),
  );

  await EngineAnalytics.initWithModel(analyticsModel);
  await EngineBugTracking.initWithModel(bugTrackingModel);
}
```

### üìà Tracking de Eventos

```dart
// Evento simples (Session ID inclu√≠do automaticamente)
await EngineAnalytics.logEvent('button_clicked');

// Evento com par√¢metros
await EngineAnalytics.logEvent('purchase_completed', {
  'item_id': 'premium_plan',
  'value': 29.99,
  'currency': 'BRL',
  'category': 'subscription',
});

// Evento de abertura do app
await EngineAnalytics.logAppOpen();
```

### üë§ Gerenciamento de Usu√°rio

```dart
// Definir ID do usu√°rio
await EngineAnalytics.setUserId('user_12345');

// Com informa√ß√µes completas (para Faro/Clarity)
await EngineAnalytics.setUserId(
  'user_12345',
  'usuario@exemplo.com',
  'Jo√£o Silva',
);

// Propriedades do usu√°rio
await EngineAnalytics.setUserProperty('user_type', 'premium');
await EngineAnalytics.setUserProperty('plan', 'monthly');
```

### üß≠ Navega√ß√£o de Telas

```dart
// Tela simples
await EngineAnalytics.setPage('HomeScreen');

// Com contexto completo
await EngineAnalytics.setPage(
  'ProductScreen',      // Tela atual
  'HomeScreen',        // Tela anterior
  'ECommerceApp',      // Classe da tela
);
```

### üêõ Bug Tracking

```dart
// Log estruturado
await EngineBugTracking.log('Usu√°rio realizou compra', {
  'user_id': '12345',
  'product_id': 'abc-123',
  'amount': 29.99,
});

// Capturar erros
try {
  // c√≥digo que pode falhar
} catch (error, stackTrace) {
  await EngineBugTracking.recordError(
    error,
    stackTrace,
    reason: 'Falha no processamento de pagamento',
  );
}

// Definir contexto do usu√°rio
await EngineBugTracking.setUserIdentifier('user_12345');
await EngineBugTracking.setCustomKey('subscription_plan', 'premium');
```

### üìù Sistema de Logging

```dart
// Diferentes n√≠veis de log
EngineLog.debug('Debug information');
EngineLog.info('Informational message');
EngineLog.warning('Warning message');
EngineLog.error('Error occurred');
EngineLog.fatal('Fatal error');

// Com contexto adicional
EngineLog.info('User action', context: {
  'action': 'button_click',
  'screen': 'home',
  'user_id': '12345',
});

// Incluir em analytics (padr√£o: false para debug/info)
EngineLog.warning('Important warning', includeInAnalytics: true);
```

### üëÅÔ∏è View Tracking com Widgets

```dart
class HomePage extends EngineStatelessWidget {
  HomePage({super.key});

  @override
  String get screenName => 'home';

  @override
  Map<String, dynamic>? get screenParameters => {
    'user_type': 'premium',
    'version': '1.0.0',
  };

  @override
  Widget buildWithTracking(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Home')),
      body: ElevatedButton(
        onPressed: () {
          logUserAction('cta_clicked', parameters: {
            'button_type': 'primary',
            'location': 'header',
          });
        },
        child: const Text('Click Me'),
      ),
    );
  }
}
```

```dart
class ShoppingCartPage extends StatefulWidget {
  final List<Product> initialProducts;
  
  const ShoppingCartPage({super.key, required this.initialProducts});

  @override
  State<ShoppingCartPage> createState() => _ShoppingCartPageState();
}

class _ShoppingCartPageState extends EngineStatefulWidgetState<ShoppingCartPage> {
  
  late List<Product> _products;
  
  @override
  void initState() {
    super.initState();
    _products = List.from(widget.initialProducts);
  }
  
  @override
  String get screenName => 'shopping_cart';

  @override
  Map<String, dynamic>? get screenParameters => {
    'initial_product_count': widget.initialProducts.length,
    'cart_value': _calculateTotal(),
  };

  @override
  Widget buildWithTracking(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Carrinho')),
      body: ListView.builder(
        itemCount: _products.length,
        itemBuilder: (context, index) {
          final product = _products[index];
          return ListTile(
            title: Text(product.name),
            trailing: IconButton(
              icon: const Icon(Icons.remove_circle),
              onPressed: () {
                setState(() {
                  _products.removeAt(index);
                });
                
                logUserAction('product_removed', parameters: {
                  'product_id': product.id,
                  'product_name': product.name,
                  'remaining_count': _products.length,
                });
                
                logStateChange('cart_updated', additionalData: {
                  'action': 'removal',
                  'new_total': _calculateTotal(),
                });
              },
            ),
          );
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          logUserAction('checkout_initiated', parameters: {
            'product_count': _products.length,
            'total_value': _calculateTotal(),
          });
        },
        child: const Icon(Icons.shopping_cart_checkout),
      ),
    );
  }
  
  double _calculateTotal() {
    return _products.fold(0.0, (sum, product) => sum + product.price);
  }
}
```

### ‚úÖ Verifica√ß√£o de Status

```dart
// Verificar se analytics est√° habilitado
if (EngineAnalytics.isEnabled) {
  print('‚úÖ Analytics est√° ativo');
}

// Verificar servi√ßos espec√≠ficos
if (EngineAnalytics.isFirebaseAnalyticsEnabled) {
  print('üî• Firebase Analytics ativo');
}

if (EngineAnalytics.isFaroEnabled) {
  print('üìä Faro Analytics ativo');
}

if (EngineAnalytics.isGoogleLoggingInitialized) {
  print('‚òÅÔ∏è Google Cloud Logging ativo');
}
```

---

## ü§ù Como Contribuir

Contribui√ß√µes s√£o bem-vindas! Por favor:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

### üìã Diretrizes de Contribui√ß√£o

- Siga o padr√£o de c√≥digo existente
- Documente novas funcionalidades
- Valide em Android e iOS
- Atualize o CHANGELOG.md

### üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo LICENSE para detalhes.

---

## üè¢ Sobre a STMR

Desenvolvido pela **STMR** - Especialistas em solu√ß√µes m√≥veis.

A STMR √© uma empresa focada no desenvolvimento de solu√ß√µes tecnol√≥gicas inovadoras para dispositivos m√≥veis, especializando-se em arquiteturas robustas, performance otimizada e experi√™ncias de usu√°rio excepcionais.

### üéØ Nossa Miss√£o
Fornecer ferramentas e bibliotecas Flutter de alta qualidade que aceleram o desenvolvimento de aplica√ß√µes m√≥veis enterprise, mantendo os mais altos padr√µes de seguran√ßa, performance e usabilidade.

---

**üí° Dica v1.4.0**: Para m√°xima efici√™ncia, configure apenas os servi√ßos que voc√™ realmente utiliza. A biblioteca √© otimizada para funcionar com qualquer combina√ß√£o de servi√ßos habilitados ou desabilitados. Com **Session ID autom√°tico**, voc√™ agora tem correla√ß√£o completa de logs e centraliza√ß√£o avan√ßada! üÜîüî•